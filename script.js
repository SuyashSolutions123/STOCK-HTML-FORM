        let itemNames = [
    "टेपर (Nos.)",
    "खराब टेपर (Nos.)",
    "ग्लास ट्युब (in Kg)",
    "खराब ग्लास ट्यूब (in Kg)",
    "कॉपर वायर (in Kg)",
    "कॉन्स्टंट वायर (in Kg)",
    "पांढरी पावडर (in Kg)",
    "काळी पावडर (in Kg)",
    "IN STOCK प्लॅटिनम PTTC 10% (0.03) (in gram)",
    "IN STOCK प्लॅटिनम PTTC 10% (0.04) (in gram)",
    "IN STOCK प्लॅटिनम PTTC 13% (0.03) (in gram)",
    "IN STOCK प्लॅटिनम PTTC 13% (0.04) (in gram)",
    "IN STOCK प्लॅटिनम TC 10% (0.03) (in gram)",
    "IN STOCK प्लॅटिनम TC 10% (0.04) (in gram)",
    "IN STOCK प्लॅटिनम TC 13% (0.03) (in gram)",
    "IN STOCK प्लॅटिनम TC 13% (0.04) (in gram)",
    "ON MACHINE प्लॅटिनम PTTC (in gram)",
    "ON MACHINE प्लॅटिनम TC 10% (in gram)",
    "ON MACHINE प्लॅटिनम TC 13% (in gram)",
    "ON MACHINE Rhodium 13% - 0.03mm (in gram)",
    "ON MACHINE Rhodium 10% - 0.03mm (in gram)",
    "ON MACHINE Rhodium 13% - 0.04mm (in gram)",
    "ON MACHINE Rhodium 10% - 0.04mm (in gram)",
    "IN STOCK Rhodium 13% - 0.03mm (in gram)",
    "IN STOCK Rhodium 10% - 0.03mm (in gram)",
    "IN STOCK Rhodium 13% - 0.04mm (in gram)",
    "IN STOCK Rhodium 10% - 0.04mm (in gram)",
    "ओवलेले प्लॅटिनम (Nos.)",
    "Platinum Scrap (in grams)",
    "FR टेपर (Nos.)",
    "Trey / ट्रे (Nos.)",
    "३० u ग्लास ट्यूब (in Kg)",
    "calol 70 (in Kg)",
    "clyrak (in Kg)",
    "1335 s&p casting (Nos.)",
    "कास्टिंग (Nos.)",
    "ST01 (Nos.)",
    "खराब Casting (Nos.)",
    "रेडी वेल्डिंग (Nos.)",
    "बारीक पिन (in Kg)",
    "मोठी पिन (in Kg)",
    "स्टार्च पावडर (in Kg)",
    "सिलिका पावडर (in Kg)",
    "कापूस (in Kg)",
    "सिलिकेट (in Kg)",
    "सिलिका २०% (in Kg)",
    "स्लिव (Nos.)",
    "खराब स्लिव (Nos.)",
    "थर्मोकॉल (Nos.)",
    "पिन लावलेले टेंपर (Nos.)",
    "Box (Nos.)",
    "तयार Tips (Nos.)",
    "Yellow Cap (Nos.)",
    "Copper Pins (in Kg)",
    "Constant Pins (in Kg)",
    "S&P Scrap (Nos.)",
    "Sleeve Tube (Nos.)",
    "New Sleeve Tube (Nos.)",
    "Sheet (Nos.)",
    "Rubber (Nos.)",
    "Packing Strip (Nos.)",
    "Stick Tapes (Nos.)",
    "Ok Box (Total Quantity)",
    "New Box",
    "Wrapping Roll (Nos.)",
    "Copper Bent Pins (in Kg)",
    "Constant Bend Pins (in Kg)",
    "Ceramic (LD) (Nos.)",
    "Ceramic (New) (Nos.)",
    "Copper Roll (in Kg)",
    "Constant Roll (in Kg)",
    "LD Scrap (in Kg)",
    "1275 Quartz tube bundle (S&P) (in Kg)",
    "32.5mm Glass Tube Cutting (in Kg)",
    "19U bent glass tube (in Kg)",
    "37mm cut tube (in Kg)",
    "21U bent glass tube (in Kg)",
    "1250 tube bundle(LD) (in Kg)",
    "75mm cut tube (in Kg)",
    "37.5U bent glass tube (in Kg)",
    "35U bent glass tube (in Kg)",
    "Glass Tube Scrap (in Kg)",
    "Fiber",
    "LD Sleeve 75mm Small",
    "LD Sleeve 75mm Big",
    "Ready Welding",
    "HIPS SH300 (in Kg)",
    "HIPS FR (in Kg)",
    "GF 15% Nylon (in Kg)",
    "GF 6% Nylon (in Kg)",
    "GF 30% Nylon (in Kg)",
    "S&P Taper Yellow (Nos.)",
    "S&P Taper red (Nos.)",
    "S&P Taper orange (Nos.)",
    "S&P Taper regular brown (Nos.)",
    "S&P Taper Violet (Nos.)",
    "S&P FR Peach Taper (Nos.)",
    "Big ring Ceramic (Nos.)",
    "HIPS Granding (in Kg)",
    "HIPS FR Granding (in Kg)",
    "GF 15% Nylon Granding (in Kg)",
    "1275mm Quartz tube for cup (in Kg)",
    "1.29mm Alloy Cutting Wire (in Kg)",
    "1.62mm Copper Cutting Wire (in Kg)",
    "1.29mm Alloy on Spool (in Kg)",
    "1.62mm Copper on Spool (in Kg)",
    "Bend of Copper (in Kg)",
    "Bend of Alloy (in Kg)",
    "1250 Quartz tube Ceramic tip (Nos.)",
    "Cup Holder For Square Cup (Nos.)",
    "Tip Holder Suyash (Nos.)",
    "Cup Holder For Super Cup (Nos.)",
    "Tip Holder S&P (Nos.)",
    "Cup Holder New Super Cup (Nos.)",
    "305 * 150 * 255 Cup Stand Packing (Nos.)",
    "Oxyprobe Holder (Nos.)",
    "280mm * 280mm * 165mm TEMP Tips Ceramic Outer Box (Nos.)",
    "Cup Stand Super Yellow (Nos.)",
    "Cup Stand New Super Cup Yellow (Nos.)",
    "Resin Coated Sand Sampler (in Kg)",
    "Compansating Cable for Tip-rubber (in Meter)",
    "Compansating Cable for Tip-Teflon Coated (in Meter)",
    "Compansating Cable for Tip-100 mtr (in Meter)",
    "Compansating Cable for Cup-100 mtr (in Meter)",
    "Compansating Cable for Oxy-Probe (in Meter)",
    "Copper Pipe Straight",
    "Handles For Lance (Nos.)",
    "M.S. Turned 17mm Sleeve for Tip Holder (Nos.)",
    "Stainless Steel pipe 5 feet (13 * 15) (Nos.)",
    "Stainless Steel pipe 10 feet (13 * 16) (Nos.)",
    "T1-10 Guage (in Kg)",
    "T2-10 Guage (in Kg)",
    "Gum Tape(Brown self adhesiv)-2 inch (Nos.)",
    "2mm blue sleeve (in Meter)",
    "2mm white sleeve (in Meter)",
    "3mm white sleeve (in Meter)",
    "3mm blue sleeve (in Meter)",
    "compansating cable industrial fibre glass cable (in Meter)",
    "5mm pvc sleeve white (in Meter)",
    "5mm pvc sleeve blue (in Meter)",
    "M.S. Turned 16mm Sleeve for S&P Tip Holder (in Meter)",
    "Copper Pipe Straight for S&P (in Kg)",
    "Aluminium wire (Strips) (in Meter)",
    "Titanium Strip- R&D",
    "Sampler Spoons(Round 12mm) (Nos.)",
    "Alloy(Cuprothal SNX) 0.77mm (Nos.)",
    "8mm sleeves",
    "Titanium Strip-RI",
    "Araldiate (in Kg)",
    "Copper Wire-20 guage (in Kg)",
    "Quartz tube for sampler (6 * 8 mm) (in Kg)",
    "Solder wire(Metalloy) (in grams)",
    "Copper ROD Straight for S&P 4mm (in Kg)",
    "Plastic housing",
    "GF 15H Natural (in Kg)",
    "Copper ROD Straight (in Kg)",
    "Sampler steel Cap (Nos.)",
    "खराब Sampler (Nos.)",
    "3.2 copper pin तुकडे(in Kg)",
    "5.3 copper pin (Nos.)",
    "S&P Holder Moulding",
    "copper pin S&P holder",
    "11mm copper pipe तुकडे",
    "11mm copper pipe straight",
    "5ft Lance S&p holder (Nos.)",
    "10ft Straight Lance S&p holder (Nos.)",
    "S&P Portable Lance (Nos.)",
    "S&P 1ft Lance and 10 meter cable (Nos.)",
    "Suyash Holder 1ft Lance (Nos.)",
    "Suyash Holder Portable Lance (Nos.)",
    "6.8 mm copper pipe (in Kg)",
    "6 mm copper rod (in Kg)"
];


        function showSuggestions(inputElement, suggestionsElement, options) {
            const filter = inputElement.value.toLowerCase().trim();
            if (filter === '') {
                suggestionsElement.style.display = 'none';
                return;
            }
            const suggestions = options.filter(option => option.toLowerCase().includes(filter));
            suggestionsElement.innerHTML = suggestions.map(option => `<div class="suggestion-item" onclick="selectSuggestion('${option}', '${inputElement.id}', '${suggestionsElement.id}')">${option}</div>`).join('');
            suggestionsElement.style.display = suggestions.length > 0 ? 'block' : 'none';
        }

        function selectSuggestion(value, inputId, suggestionsId) {
            const inputElement = document.getElementById(inputId);
            const suggestionsElement = document.getElementById(suggestionsId);
            inputElement.value = value;
            suggestionsElement.style.display = 'none';
        }

        document.addEventListener('click', (event) => {
            const suggestionsElement = document.getElementById('suggestions');
            if (!suggestionsElement.contains(event.target) && event.target !== document.getElementById('item')) {
                suggestionsElement.style.display = 'none';
            }
        });
//above is for item name matching result


// refresh page script code
document.addEventListener('DOMContentLoaded', () => {
    let startY = 0;
    const refreshIcon = document.createElement('div');
    refreshIcon.classList.add('refresh-icon');
    refreshIcon.innerHTML = '&#x21bb;';
    document.body.appendChild(refreshIcon);

    window.addEventListener('touchstart', (e) => {
        if (window.scrollY === 0) startY = e.touches[0].clientY;
    });

    window.addEventListener('touchmove', (e) => {
        if (window.scrollY === 0 && e.touches[0].clientY > startY + 50) {
            refreshIcon.style.display = 'block';
        }
    });

    window.addEventListener('touchend', () => {
        if (refreshIcon.style.display === 'block') location.reload();
        refreshIcon.style.display = 'none';
    });
});

// page script
document.addEventListener('DOMContentLoaded', () => {
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('date').value = today;

           document.getElementById('add-field-btn').addEventListener('click', addField);
            document.getElementById('add-entered-item-btn').addEventListener('click', addEnteredItem);
            document.getElementById('add-known-item-btn').addEventListener('click', addKnownItem);
        });

        const addField = () => {
            const fieldsDiv = document.getElementById('fields');
            const fieldDiv = document.createElement('div');
            fieldDiv.className = 'field-group';
            fieldDiv.innerHTML = `
                <input style="background-color:#f0f0f0;" type="text" placeholder="Field Name" name="fieldName[]">
                <input style="background-color:#f0f0f0;" type="text" placeholder="Value" name="fieldValue[]">
            `;
            fieldsDiv.appendChild(fieldDiv);
        };

        const addEnteredItem = () => {
            const itemName = document.querySelector('input[name="productName"]').value;
            const fieldNames = Array.from(document.querySelectorAll('input[name="fieldName[]"]')).map(input => input.value);
            const fieldValues = Array.from(document.querySelectorAll('input[name="fieldValue[]"]')).map(input => input.value);

            if (!itemName) {
                alert('Item name is required.');
                return;
            }

            const enteredItemDiv = document.createElement('div');
            enteredItemDiv.className = 'entered-item';
            enteredItemDiv.dataset.type = 'dynamic';
            enteredItemDiv.innerHTML = `<strong>Item Name:</strong> ${itemName}`;

            fieldNames.forEach((fieldName, index) => {
                const fieldDiv = document.createElement('div');
                fieldDiv.innerText = `${fieldName}: ${fieldValues[index]}`;
                enteredItemDiv.appendChild(fieldDiv);
            });

            const actionButtonsDiv = document.createElement('div');
            actionButtonsDiv.className = 'action-buttons';
            actionButtonsDiv.innerHTML = `
                <button type="button" style="background-color:#000000" onclick="editItem(this)">Edit</button>
                <button type="button" style="background-color:#000000" onclick="deleteItem(this)">Delete</button>
            `;
            enteredItemDiv.appendChild(actionButtonsDiv);

            document.getElementById('entered-items-list').appendChild(enteredItemDiv);

            document.querySelector('input[name="productName"]').value = '';
            document.querySelectorAll('input[name="fieldName[]"]').forEach(input => input.value = '');
            document.querySelectorAll('input[name="fieldValue[]"]').forEach(input => input.value = '');
            document.getElementById('fields').innerHTML = '';
        };

        const addKnownItem = () => {
             const itemName = document.getElementById('known-item').value;
		console.log(itemName);  
            	const itemValue = document.getElementById('known-item-value').value;
		console.log(itemValue);
            if (!itemName || !itemValue) {
                alert('Item name and value are required.');
                return;
            }
 // Clear the fields after 2 seconds if the button was clicked
       		 setTimeout(() => {
       		 document.getElementById('known-item').value = '';
        	 document.getElementById('known-item-value').value = '';
        	 }, 1000);
		
            const enteredItemDiv = document.createElement('div');
            enteredItemDiv.className = 'entered-item';
            enteredItemDiv.dataset.type = 'known';
            enteredItemDiv.dataset.itemName = itemName;
		//console.log("entered items div: "+ itemName); correct
            enteredItemDiv.innerHTML = `<strong>Item Name:</strong> ${itemName}`;
            const fieldDiv = document.createElement('div');
            fieldDiv.innerText = `Value: ${itemValue}`;
            enteredItemDiv.appendChild(fieldDiv);

            const actionButtonsDiv = document.createElement('div');
            actionButtonsDiv.className = 'action-buttons';
            actionButtonsDiv.innerHTML = `
                <button type="button" style="background-color:#000000" onclick="editItem(this)">Edit</button>
                <button type="button" style="background-color:#000000" onclick="deleteItem(this)">Delete</button>
            `;
            enteredItemDiv.appendChild(actionButtonsDiv);

            document.getElementById('entered-items-list').appendChild(enteredItemDiv);

            document.getElementById('other-item').value = '';
            document.getElementById('known-item-value').value = '';
            if (itemSelect.value === 'other') {
                itemSelect.value = '';
            }
        };

        const editItem = (button) => {
            const itemDiv = button.closest('.entered-item');
            const itemType = itemDiv.dataset.type;

            if (itemType === 'known') {
                const itemName = itemDiv.dataset.itemName;
                const fieldValue = itemDiv.querySelector('div').innerText.replace('Value: ', '');

                const itemSelect = document.getElementById('known-item');
                itemSelect.value = itemName;
		itemDiv.remove();  // clear entered item div for known item entry after click on 'edit' button. 
                if (itemName === 'other') {
                    document.getElementById('other-item').style.display = 'block';
                    document.getElementById('other-item').value = itemDiv.querySelector('strong').innerText.replace('Item Name: ', '');
                } else {
                    document.getElementById('other-item').style.display = 'none';
                }

                document.getElementById('known-item-value').value = fieldValue;
            } else if (itemType === 'dynamic') {
                const itemName = itemDiv.querySelector('strong').innerText.replace('Item Name: ', '');
                const fields = Array.from(itemDiv.querySelectorAll('div')).map(div => div.innerText.split(': '));

                document.querySelector('input[name="productName"]').value = itemName;
                document.getElementById('fields').innerHTML = '';

                fields.forEach(field => {
                    if (field[0] && field[1]) {
                        const fieldDiv = document.createElement('div');
                        fieldDiv.className = 'field-group';
                        fieldDiv.innerHTML = `
                            <input style="background-color:#f0f0f0;" type="text" placeholder="Field Name" name="fieldName[]" value="${field[0]}">
                            <input style="background-color:#f0f0f0;"  type="text" placeholder="Value" name="fieldValue[]" value="${field[1]}">
                        `;
                        document.getElementById('fields').appendChild(fieldDiv);
                    }
                });
            }

            itemDiv.remove();
        };

     /*   const deleteItem = (button) => {
            button.closest('.entered-item').remove();
        };
	
	*/
	const deleteItem = (button) => {
    const itemDiv = button.closest('.entered-item');
    const itemType = itemDiv.dataset.type;
    const itemName = itemType === 'known' ? itemDiv.dataset.itemName : itemDiv.querySelector('strong').innerText.replace('Item Name:', '').trim();

    // Remove the deleted item from enteredItemsArray
    //enteredItemsArray = enteredItemsArray.filter(item => item.itemName !== itemName);

    // Remove the item from the DOM
    itemDiv.remove();
};

       const handleSubmit = (event) => {
    event.preventDefault();
    if (!navigator.onLine) {
        alert('No internet connection.');
        return;
    }

    const formData = new FormData(event.target);

    // Extracting date
    const date = formData.get('date');

    // Extracting entered items
    const enteredItems = document.querySelectorAll('.entered-item');
    const enteredItemsArray = Array.from(enteredItems).map(item => {
/*
    //const itemName = item.querySelector('.item-name').value.trim();  //'strong'
    const itemNameElement = item.querySelector('.item-name');
    const itemName = itemNameElement ? itemNameElement.innerText.trim() : item.dataset.itemName;
// above 2 line change

*/
    let itemName = '';

        // Extract the item name based on the item type
        if (item.dataset.type === 'known') {
            // For known items, retrieve item name from data attribute
            itemName = item.dataset.itemName;
        } else {
            // For dynamic items, retrieve item name from the strong element
            const strongElement = item.querySelector('strong');
            if (strongElement) {
                const itemNameText = strongElement.nextSibling ? strongElement.nextSibling.nodeValue.trim() : '';
                itemName = itemNameText;
            }
        }

    const fields = Array.from(item.querySelectorAll('div')).filter(div => !div.classList.contains('action-buttons')).map(div=> {
            const parts = div.innerText.split(': ');
            return { name: parts[0].trim(), value: parts[1].trim() };
        });
        return { itemName, fields };
    });

    // Combining username and other name into a single field
    const userName = formData.get('username') === 'other' ? formData.get('otherName') : formData.get('username');

    // Constructing the data object
    const dataObject = {
        name: userName,
        date,
        enteredItems: enteredItemsArray
    };

    console.log('Data Object:', dataObject);
    var url = "https://script.google.com/macros/s/AKfycbzag6QY4eowUoX-4vyETBiOzQ7X6euroQ0agNLr2XrEO9hiGKBs3DT3iN_vE5DACRsS/exec";
    // Posting data to the server
    fetch(url, {
	redirect:"follow",
        method: 'POST',
        body: JSON.stringify(dataObject),
        headers: {
            'Content-Type': 'text/plain;charset=utf-8',
        },
    })
        .then(response => {
            console.log('Response:', response);
            return response.json();
        })
        .then(data => {
            console.log('Data:', data);
            if (data.status === 'success') {
                alert('Form submitted successfully.');
                document.getElementById('combined-form').reset();
                document.getElementById('date').value = new Date().toISOString().split('T')[0];
                document.getElementById('entered-items-list').innerHTML = '';
		location.reload();
            } else {
                throw new Error('Failed to submit form.');
            }
        })
        .catch((error) => {
            alert('Failed to submit the form.');
		console.error('Stack Trace:', error.stack); // Log the stack trace
            console.error('Error:', error);
        });
};


        document.addEventListener('focusin', (event) => {
            const target = event.target;
            if (target.tagName === 'INPUT' || target.tagName === 'SELECT') {
                setTimeout(() => {
                    target.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }, 300);
            }
        });
